<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Name="Digital Clock" Id="*" UpgradeCode="{19300332-9971-4ECE-B0AA-2D4ABF2DFC7D}"
    Language="1033" Codepage="1252" Version="4.5.0" Manufacturer="Nick Korotysh">

    <Package Id="*" Keywords="Installer" Platform="x86" Description="Digital Clock"
      Comments="Digital Clock 4.5.0 x86 Installer" Manufacturer="Nick Korotysh"
      InstallerVersion="405" InstallScope="perMachine" Compressed="yes" Languages="1033" SummaryCodepage="1252" />

    <Property Id="ARPCONTACT">mailto:nick.korotysh@gmail.com</Property>
    <Property Id="ARPHELPLINK">http://sourceforge.net/projects/digitalclock4/support</Property>
    <Property Id="ARPURLINFOABOUT">http://sourceforge.net/projects/digitalclock4/</Property>
    <Property Id="ARPURLUPDATEINFO">http://sourceforge.net/projects/digitalclock4/</Property>

    <Property Id="ARPPRODUCTICON">app_icon.ico</Property>

    <Property Id="ARPNOMODIFY">1</Property>

    <Condition Message="Windows 7 SP1 or higher is required"><![CDATA[VersionNT AND WindowsBuild > 7600]]></Condition>
    <Condition Message="32 bits per pixel color is required"><![CDATA[ColorBits = 32]]></Condition>

    <Upgrade Id="{19300332-9971-4ECE-B0AA-2D4ABF2DFC7D}">
      <UpgradeVersion
        Minimum="4.4.0" Maximum="4.5.0"
        Property="PREVIOUSVERSIONSINSTALLED"
        IncludeMinimum="yes" IncludeMaximum="yes" />
    </Upgrade>

    <Media Id="1" Cabinet="_data1.cab" EmbedCab="yes" DiskPrompt="CD-ROM #1" />
    <Property Id="DiskPrompt" Value="Digital Clock 4 Installation [1]" />

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder" Name="PFiles">
        <Directory Id="manufacturer_dir" Name="Nick Korotysh">
          <Directory Id="INSTALLDIR" Name="Digital Clock">
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder">
        <Directory Id="ProgramMenuDir" Name="Digital Clock">
          <Component Id="ProgramMenuDir" Guid="{DDE65D32-3CC9-4F7A-BEA2-FBB6D627A49E}">
            <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
            <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Type="string" Value="" KeyPath="yes" />
          </Component>
        </Directory>
      </Directory>

      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <Feature Id="Complete" Level="1">
      <ComponentGroupRef Id="QtFiles" />
      <ComponentGroupRef Id="ClockFiles" />
      <ComponentGroupRef Id="skins" />
      <ComponentGroupRef Id="textures" />
      <ComponentRef Id="ProgramMenuDir" />
    </Feature>

    <Icon Id="app_icon.ico" SourceFile="..\..\digital_clock\resources\clock_icon_win.ico" />

    <CustomAction Id="export_settings" Directory="TARGETDIR" ExeCommand="reg.exe export &quot;HKCU\Software\Nick Korotysh\Digital Clock&quot; &quot;[%TMP]\nick-clock-settings.reg&quot; /y" Return="check" />
    <CustomAction Id="import_settings" Directory="TARGETDIR" ExeCommand="reg.exe import &quot;[%TMP]\nick-clock-settings.reg&quot;" Return="check" />

    <InstallExecuteSequence>
      <Custom Action='export_settings' Before='RemoveExistingProducts'>PREVIOUSVERSIONSINSTALLED OR REINSTALL</Custom>
      <Custom Action='import_settings' After='InstallFinalize'>PREVIOUSVERSIONSINSTALLED OR REINSTALL</Custom>
      <RemoveExistingProducts Before="InstallInitialize" />
    </InstallExecuteSequence>

  </Product>
</Wix>